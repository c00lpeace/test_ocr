# Gradio OCR/Describe 시스템 - UI 설계 명세서

## 📋 문서 정보

- **프로젝트명**: Gradio 기반 OCR/Describe 웹 애플리케이션
- **문서 버전**: 1.0
- **작성일**: 2025-01-30
- **목적**: 3-Panel 동시 비교 테스트를 위한 Gradio UI 설계

---

## 🎯 프로젝트 개요

### 핵심 컨셉
하나의 이미지(또는 이미지 세트)에 대해 **3가지 다른 설정**을 동시에 적용하여 결과를 비교할 수 있는 데모 시스템

### 주요 특징
1. **3-Panel 구조**: 동일 입력에 대해 3가지 설정을 독립적으로 실행
2. **실시간 비교**: 각 패널의 결과를 나란히 비교
3. **유연한 입력**: 파일/폴더/URL/JSON 다중 입력 방식 지원
4. **순차/병렬 실행**: 실행 방식 선택 가능

---

## 🎨 화면 레이아웃 설계

### 전체 구조 (HD 1920x1080 기준)

```
┌─────────────────────────────────────────────────────────────┐
│  📸 OCR/Describe 이미지 처리 시스템 (3-Panel Demo)          │  ← 80px
├─────────────────────────────────────────────────────────────┤
│  ┌──────────────────┬───────────────────────────────────┐  │
│  │  📥 입력 탭       │  🖼️ 입력 미리보기                  │  │  350px
│  │  (1)             │  (2)                              │  │  (1:2 비율)
│  │  [파일/URL/JSON] │  [Gallery + 요약]                 │  │
│  └──────────────────┴───────────────────────────────────┘  │
│                                                             │
│  [🚀 전체 실행]  [순차/병렬 선택]                           │  60px
│                                                             │
├──────────────┬──────────────┬──────────────────────────────┤
│  Panel 1     │  Panel 2     │  Panel 3                    │  120px
│  [설정]      │  [설정]      │  [설정]                      │  (1:1:1)
│  [▶ 실행]    │  [▶ 실행]    │  [▶ 실행]                   │
└──────────────┴──────────────┴──────────────────────────────┘
                                                         ↑
                                        여기까지 610px (스크롤 없이)
═══════════════════════════════════════════════════════════════
                         ↓ 실행 시 자동 스크롤 ↓
═══════════════════════════════════════════════════════════════
┌──────────────┬──────────────┬──────────────────────────────┐
│  📊 결과 1    │  📊 결과 2    │  📊 결과 3                   │
│              │              │                              │
│  [진행상황]   │  [진행상황]   │  [진행상황]                  │
│  [갤러리]     │  [갤러리]     │  [갤러리]                    │
│  [OCR 결과]   │  [OCR 결과]   │  [OCR 결과]                  │
│  [다운로드]   │  [다운로드]   │  [다운로드]                  │
└──────────────┴──────────────┴──────────────────────────────┘
```

### 높이 배분 전략
| 영역 | 높이 | 설명 |
|------|------|------|
| 헤더 | 80px | 타이틀 및 설명 |
| 입력 영역 | 350px | 탭 + 미리보기 (1:2 비율) |
| 실행 제어 | 60px | 전체 실행 버튼 + 옵션 |
| 패널 설정 | 120px | 3개 패널 설정 (접힌 상태) |
| **합계** | **610px** | **스크롤 없이 표시** |
| 결과 영역 | 나머지 | 스크롤 후 표시 |

---

## 📥 입력 영역 상세 설계

### 1. 입력 탭 구조 (좌측, 33%)

#### Tab 1: 📁 파일/폴더 (기본 활성화)
```
┌─────────────────────────────┐
│ 📁 파일/폴더                 │
├─────────────────────────────┤
│ [파일 선택 영역]             │
│ (다중 선택 가능)             │
│                             │
│ 📂 또는 폴더 경로 입력:      │
│ [___________________]       │
│ [폴더에서 이미지 불러오기]   │
│                             │
│ 상품 번호 (선택):            │
│ [___________________]       │
└─────────────────────────────┘
```

**기능:**
- 파일 Drag & Drop 또는 클릭하여 선택
- 다중 파일 선택 가능
- 폴더 경로 입력 → 버튼 클릭 → 폴더 내 모든 이미지 로드
- 지원 형식: `.png`, `.jpg`, `.jpeg`, `.gif`, `.webp`, `.bmp`
- 상품 번호 미입력 시 자동 생성: `MANUAL_001`, `MANUAL_002`, ...

#### Tab 2: 🔗 URL
```
┌─────────────────────────────┐
│ 🔗 URL                      │
├─────────────────────────────┤
│ 이미지 URL 입력:             │
│ [_______________________]   │
│ [_______________________]   │
│ [_______________________]   │
│ (여러 URL은 쉼표로 구분)     │
│                             │
│ [🔄 URL에서 불러오기]        │
│                             │
│ 상품 번호 (선택):            │
│ [___________________]       │
└─────────────────────────────┘
```

**기능:**
- 쉼표(`,`)로 구분하여 여러 URL 입력
- 예: `https://example.com/1.jpg, https://example.com/2.jpg`
- 버튼 클릭 시 URL에서 이미지 다운로드

#### Tab 3: 📄 JSON
```
┌─────────────────────────────┐
│ 📄 JSON                     │
├─────────────────────────────┤
│ [JSON 파일 선택]             │
│                             │
│ JSON 형식 예시:              │
│ [                           │
│   {                         │
│     "godNo": "GR9125...",   │
│     "img_path": ["url1"...] │
│   }                         │
│ ]                           │
└─────────────────────────────┘
```

**기능:**
- JSON 파일 업로드
- 파일 선택 시 자동 파싱
- 여러 상품 데이터 처리

### 2. 입력 미리보기 (우측, 67%)

```
┌────────────────────────────────────┐
│ 🖼️ 입력 미리보기                    │
├────────────────────────────────────┤
│ [이미지1] [이미지2] [이미지3] ...   │
│                                    │
│ [이미지5] [이미지6] [이미지7] ...   │
│                                    │
│ (4열 x 2행 Gallery)                │
├────────────────────────────────────┤
│ 📊 입력 요약:                       │
│ ✅ 총 8개 이미지 로드됨              │
└────────────────────────────────────┘
```

**컴포넌트:**
- `gr.Gallery`: 4열 x 2행, 높이 300px
- `gr.Textbox`: 입력 상태 요약 (2줄)

### 탭 전환 동작

```python
탭 전환 시:
  ├─ 현재 탭 활성화
  ├─ 다른 탭 입력값 초기화
  │   ├─ file_input → None
  │   ├─ url_input → ""
  │   └─ json_input → None
  ├─ 미리보기 갤러리 초기화
  └─ 요약 텍스트 초기화
```

---

## 🎛️ 실행 제어 영역

```
┌─────────────────────────────────────────────────────┐
│ [🚀 전체 실행 (3개 패널 모두)]  │ ⚙️ 실행 방식:     │
│                                 │ ● 순차 실행       │
│                                 │ ○ 병렬 실행       │
└─────────────────────────────────────────────────────┘
```

### 전체 실행 버튼
- **기능**: Panel 1, 2, 3을 모두 실행
- **동작**: 클릭 시 결과 영역으로 자동 스크롤
- **크기**: Large
- **색상**: Primary (파란색)

### 실행 방식 선택
- **순차 실행**: Panel 1 완료 → Panel 2 시작 → Panel 3 시작
  - 안전함, GPU 부하 적음
  - 느림 (3배 시간 소요)
  
- **병렬 실행**: Panel 1, 2, 3 동시 시작
  - 빠름 (1.5배 시간 소요)
  - GPU 메모리 부하 큼

---

## 🎨 패널 설정 영역 (3분할)

### Panel 구조 (각 패널 동일)

```
┌──────────────────────────────┐
│ 📝 Panel X 작업 모드          │
│ [Dropdown ▼]                 │
│  - OCR_PURE                  │
│  - OCR_MD                    │
│  - OCR_DESC                  │
│  - CUSTOM                    │
│                              │
│ (CUSTOM 선택 시)              │
│ 커스텀 프롬프트:              │
│ [____________________]       │
│ [____________________]       │
│                              │
│ ▼ ⚙️ 고급 설정 (접힘)         │
│                              │
│ [▶️ Panel X 실행]            │
└──────────────────────────────┘
```

### 작업 모드 (Dropdown)

| 모드 | 설명 | 기본값 |
|------|------|--------|
| `OCR_PURE` | 순수 텍스트만 추출 | Panel 1 |
| `OCR_MD` | 텍스트를 마크다운 형식으로 작성 | Panel 2 |
| `OCR_DESC` | 이미지+텍스트 정보를 마크다운으로 서술 | Panel 3 |
| `CUSTOM` | 사용자 정의 프롬프트 | - |

### CUSTOM 모드 동작

```python
if mode == "CUSTOM":
    custom_prompt.visible = True  # 프롬프트 입력창 표시
else:
    custom_prompt.visible = False  # 숨김
```

### 고급 설정 (Accordion)

```
▼ ⚙️ 고급 설정
  ├─ 크롭 높이: [━━●━━━━] 1800 px (800~3000)
  ├─ 오버랩:   [━━●━━━━] 200 px (50~500)
  └─ 💾 영구 저장: ☐ OFF (자동삭제) / ☑ ON (보관)
```

**기본값:**
- 크롭 높이: 1800px
- 오버랩: 200px
- 영구 저장: OFF (처리 후 자동 삭제)

### 실행 버튼
- **기능**: 해당 패널만 독립 실행
- **동작**: 클릭 시 결과 영역으로 자동 스크롤
- **크기**: Small
- **색상**: Primary

---

## 📊 결과 영역 (3분할)

### Panel 결과 구조 (각 패널 동일)

```
┌──────────────────────────────┐
│ 🔄 Panel X 진행               │
│ ⏸️ 대기 중                    │
├──────────────────────────────┤
│ 🖼️ 처리된 이미지 (Panel X)    │
│ [이미지1] [이미지2]           │
│ [이미지3] [이미지4]           │
│ (2열 x 2행, 250px)            │
├──────────────────────────────┤
│ _이미지를 클릭하면 결과 표시_  │
├──────────────────────────────┤
│ 📄 OCR 결과                   │
│ [                            │
│  처리 결과가 여기에...        │
│                              │
│ ]                            │
│ (8~15줄)                     │
├──────────────────────────────┤
│ [📥 결과 다운로드]            │
└──────────────────────────────┘
```

### 진행 상황 표시

| 상태 | 표시 |
|------|------|
| 대기 중 | `⏸️ 대기 중` |
| 처리 중 | `⏳ Panel X 처리 중... (3/10 이미지)` |
| 완료 | `✅ 처리 완료 (10개 이미지)` |
| 실패 | `❌ 처리 실패: [오류 메시지]` |

### 이미지 갤러리

- **레이아웃**: 2열 x 2행
- **높이**: 250px
- **기능**: 
  - 처리된 이미지 표시
  - 크롭된 경우 청크 이미지 모두 표시
  - 클릭 시 해당 이미지의 OCR 결과 표시

### 갤러리 선택 동작

```python
갤러리 이미지 클릭 시:
  ├─ 선택된 이미지 정보 업데이트
  │   예: "**이미지 #3** 선택됨 (Panel 1)"
  └─ 해당 이미지의 OCR 결과 표시
      예: "이미지 #3의 OCR 결과\n\nTHE NORTH FACE..."
```

### OCR 결과 텍스트박스

- **높이**: 8~15줄 (자동 확장)
- **기능**: 
  - 갤러리에서 선택된 이미지의 결과 표시
  - 복수 이미지의 경우 개별 결과 분리 표시
  - 스크롤 가능

### 다운로드 버튼

- **기능**: 
  - JSON 형식으로 결과 다운로드
  - 파일명: `panel{X}_result_{timestamp}.json`

---

## 🔄 사용자 시나리오

### 시나리오 1: 빠른 테스트 (파일 업로드)

```
1. 사용자가 이미지 파일 3개를 Drag & Drop
   └─ 미리보기 갤러리에 3개 이미지 표시
   
2. 각 패널의 기본 설정 확인
   ├─ Panel 1: OCR_PURE
   ├─ Panel 2: OCR_MD
   └─ Panel 3: OCR_DESC
   
3. [🚀 전체 실행] 버튼 클릭
   ├─ 자동으로 결과 영역으로 스크롤
   ├─ 순차 실행 (기본값)
   └─ 각 패널에 진행 상황 표시
   
4. 결과 확인
   ├─ 각 패널의 갤러리에서 이미지 클릭
   └─ 해당 이미지의 OCR 결과 비교
   
5. 결과 다운로드
   └─ 각 패널의 [📥 결과 다운로드] 클릭
```

### 시나리오 2: 커스텀 프롬프트 테스트

```
1. 이미지 업로드 (시나리오 1 동일)

2. Panel 3 설정 변경
   ├─ 작업 모드: CUSTOM 선택
   ├─ 커스텀 프롬프트 입력창 자동 표시
   └─ 프롬프트 입력: "이미지에서 제품명과 가격만 추출하세요"
   
3. 고급 설정 변경 (옵션)
   ├─ Accordion 펼치기
   ├─ 크롭 높이: 1500px
   └─ 영구 저장: ON
   
4. Panel 3만 개별 실행
   └─ [▶️ Panel 3 실행] 클릭
   
5. 결과 확인 및 비교
   ├─ Panel 1, 2와 결과 비교
   └─ 커스텀 프롬프트 효과 확인
```

### 시나리오 3: JSON 배치 처리

```
1. Tab 3: JSON 파일 선택
   ├─ sample_data.json 업로드
   └─ 파싱 정보 표시: "10개 상품, 50개 이미지"
   
2. 실행 방식: 병렬 실행 선택
   └─ 처리 속도 향상
   
3. [🚀 전체 실행] 클릭
   └─ 3개 패널 동시 처리 시작
   
4. 진행 상황 모니터링
   ├─ 각 패널의 진행률 확인
   └─ "⏳ Panel 1 처리 중... (25/50 이미지)"
   
5. 모든 결과 다운로드
   ├─ Panel 1: panel1_result.json
   ├─ Panel 2: panel2_result.json
   └─ Panel 3: panel3_result.json
```

### 시나리오 4: 폴더 일괄 처리

```
1. Tab 1: 📁 파일/폴더
   ├─ 폴더 경로 입력: C:/Users/myname/images
   └─ [폴더에서 이미지 불러오기] 클릭
   
2. 폴더 내 모든 이미지 자동 로드
   └─ "✅ 총 147개 이미지 로드됨"
   
3. 각 패널 설정 조정
   ├─ Panel 1: OCR_PURE (기본값 유지)
   ├─ Panel 2: 고급 설정 → 크롭 높이 2000px
   └─ Panel 3: CUSTOM 모드 + 상세 설명 프롬프트
   
4. 순차 실행 선택 (안정성 우선)
   └─ GPU 메모리 관리
   
5. 장시간 처리 후 결과 확인
```

---

## 🎛️ 주요 기능 명세

### 1. 입력 처리

| 입력 방식 | 지원 형식 | 동작 |
|----------|----------|------|
| 파일 업로드 | `.png`, `.jpg`, `.jpeg`, `.gif`, `.webp`, `.bmp` | 다중 선택 가능 |
| 폴더 경로 | 디렉토리 경로 | 재귀적으로 이미지 검색 |
| URL | `http://`, `https://` | 쉼표 구분 다중 URL |
| JSON | `.json` | 표준 JSON 형식 파싱 |

### 2. 탭 전환 동작

```python
탭 전환 이벤트 발생:
  if 새로운 탭 == "파일/폴더":
      url_input = ""
      json_input = None
  elif 새로운 탭 == "URL":
      file_input = None
      json_input = None
  elif 새로운 탭 == "JSON":
      file_input = None
      url_input = ""
  
  # 공통 초기화
  preview_gallery = None
  input_summary = "입력을 선택하세요"
```

### 3. 실행 플로우

#### 개별 실행
```
사용자가 Panel X [▶️ 실행] 클릭
  ↓
입력 이미지 확인
  ↓
Panel X 설정 로드
  ├─ mode (OCR_PURE/MD/DESC/CUSTOM)
  ├─ custom_prompt (CUSTOM일 경우)
  ├─ crop_height
  ├─ overlap
  └─ save_permanent
  ↓
결과 영역으로 자동 스크롤
  ↓
Panel X 진행 상황 업데이트
  ├─ "⏳ Panel X 처리 중... (1/10 이미지)"
  └─ Progress Bar 업데이트
  ↓
이미지 처리 (OCR/Describe)
  ↓
결과 표시
  ├─ 갤러리에 이미지 추가
  └─ 첫 번째 이미지 결과 자동 표시
  ↓
완료
  └─ "✅ 처리 완료 (10개 이미지)"
```

#### 전체 실행

**순차 실행:**
```
[🚀 전체 실행] 클릭
  ↓
결과 영역으로 자동 스크롤
  ↓
Panel 1 실행 → 완료 대기
  ↓
Panel 2 실행 → 완료 대기
  ↓
Panel 3 실행 → 완료 대기
  ↓
전체 완료
```

**병렬 실행:**
```
[🚀 전체 실행] 클릭
  ↓
결과 영역으로 자동 스크롤
  ↓
Panel 1, 2, 3 동시 실행
  ├─ 각 패널 독립적 진행
  └─ 완료 시점 각각 다름
  ↓
모든 패널 완료 확인
```

### 4. 자동 스크롤

```javascript
// 실행 버튼 클릭 시 JavaScript 실행
function scrollToResults() {
    const resultsSection = document.querySelector('#results-section');
    if (resultsSection) {
        resultsSection.scrollIntoView({ 
            behavior: 'smooth',  // 부드러운 스크롤
            block: 'start'       // 영역 최상단으로
        });
    }
}
```

### 5. 복수 이미지 결과 표시

#### 갤러리 방식 (채택)
```
Gallery (2열 x 2행):
  ├─ [이미지 1] [이미지 2]
  └─ [이미지 3] [이미지 4]

클릭 시:
  ├─ 선택 정보 업데이트
  │   "**이미지 #2** 선택됨"
  └─ 결과 텍스트 업데이트
      "이미지 #2의 OCR 결과\n\n[실제 텍스트]"
```

#### JSON 다운로드 형식
```json
{
  "panel": 1,
  "mode": "OCR_PURE",
  "timestamp": "2025-01-30T14:30:00",
  "results": [
    {
      "image_index": 1,
      "image_name": "image_1.jpg",
      "ocr_text": "THE NORTH FACE\n...",
      "processing_time": "2.3s",
      "is_cropped": false
    },
    {
      "image_index": 2,
      "image_name": "image_2.jpg",
      "ocr_text": "...",
      "processing_time": "5.1s",
      "is_cropped": true,
      "chunks": 2
    }
  ],
  "summary": {
    "total_images": 10,
    "success": 10,
    "failed": 0,
    "total_time": "45.2s"
  }
}
```

---

## 🎨 스타일 및 테마

### Gradio 테마
```python
theme = gr.themes.Soft()
```

### 커스텀 CSS
```css
/* 입력 영역 높이 제한 */
#input-section {
    max-height: 350px;
}

/* 실행 제어 영역 패딩 */
#control-section {
    padding: 10px 0;
}

/* 패널 설정 영역 패딩 */
#panels-section {
    padding: 10px 0;
}

/* 결과 영역 상단 여백 */
#results-section {
    margin-top: 20px;
}

/* 컴팩트한 요소 */
.compact {
    margin: 5px 0 !important;
}
```

### 색상 가이드

| 요소 | 색상 | 용도 |
|------|------|------|
| Primary Button | Blue (#2563EB) | 실행 버튼 |
| Secondary Button | Gray | 보조 버튼 |
| Success | Green (#10B981) | 완료 상태 |
| Warning | Yellow (#F59E0B) | 진행 중 |
| Error | Red (#EF4444) | 실패 상태 |

---

## 📱 반응형 고려사항

### 최소 지원 해상도
- **데스크톱**: 1920 x 1080 (Full HD)
- **노트북**: 1366 x 768 (최소)

### 모바일 미지원
- 현재 버전은 데스크톱 전용 설계
- 향후 모바일 대응 시 탭 구조로 변경 필요

---

## 🔧 기술 스택

### 프레임워크
- **Gradio**: 4.0.0+
- **Python**: 3.9+

### 주요 컴포넌트

| Gradio 컴포넌트 | 용도 |
|----------------|------|
| `gr.Tabs` | 입력 방식 전환 |
| `gr.File` | 파일/JSON 업로드 |
| `gr.Textbox` | URL/프롬프트/결과 입력 |
| `gr.Gallery` | 이미지 미리보기/결과 |
| `gr.Dropdown` | 작업 모드 선택 |
| `gr.Slider` | 크롭/오버랩 설정 |
| `gr.Checkbox` | 영구 저장 옵션 |
| `gr.Radio` | 순차/병렬 선택 |
| `gr.Button` | 실행 버튼 |
| `gr.Accordion` | 고급 설정 접기 |
| `gr.Markdown` | 제목/설명 |
| `gr.State` | 전역 상태 관리 |

---

## 📋 개발 체크리스트

### Phase 1: UI 구조 (완료)
- [x] 3분할 레이아웃 설계
- [x] 입력 영역 1:2 비율 구현
- [x] 탭 전환 로직
- [x] 드롭다운 모드 선택
- [x] Accordion 고급 설정
- [x] 자동 스크롤 기능

### Phase 2: 입력 처리
- [ ] 파일 업로드 핸들러
- [ ] 폴더 경로 파싱
- [ ] URL 다운로드
- [ ] JSON 파싱
- [ ] 입력 검증

### Phase 3: 실행 로직
- [ ] Ollama OCR 연동
- [ ] 크롭 처리
- [ ] 순차/병렬 실행
- [ ] 진행률 업데이트
- [ ] 에러 핸들링

### Phase 4: 결과 처리
- [ ] 갤러리 업데이트
- [ ] 결과 텍스트 표시
- [ ] JSON 다운로드
- [ ] 복수 이미지 병합

### Phase 5: 최적화
- [ ] 성능 최적화
- [ ] 메모리 관리
- [ ] UI/UX 개선
- [ ] 버그 수정

---

## 🔍 알려진 제약사항

### Gradio 한계
1. **폴더 선택 UI 없음**
   - 대안: 텍스트 입력 + 버튼 방식
   
2. **진행률 실시간 업데이트 제한**
   - Gradio의 비동기 특성상 완벽한 실시간 업데이트 어려움
   - 대안: 주요 단계별 업데이트

3. **탭 상태 초기화 제한**
   - 완전한 초기화는 페이지 새로고침 필요
   - 대안: 주요 입력값만 초기화

### 브라우저 호환성
- **Chrome/Edge**: 완전 지원
- **Firefox**: 완전 지원
- **Safari**: 일부 CSS 미지원 가능

---

## 🚀 향후 개선 계획

### 단기 (v1.1)
- [ ] 프로그레스 바 시각화 개선
- [ ] 에러 메시지 상세화
- [ ] 결과 내보내기 옵션 추가 (CSV, Excel)

### 중기 (v1.2)
- [ ] 이미지 편집 기능 (회전, 크롭)
- [ ] 다국어 지원 (한글/영어)
- [ ] 테마 커스터마이징

### 장기 (v2.0)
- [ ] 모바일 반응형 지원
- [ ] 클라우드 스토리지 연동
- [ ] 배치 스케줄링
- [ ] API 엔드포인트 제공

---

## 📚 참고 자료

### 문서
- [Gradio 공식 문서](https://www.gradio.app/docs)
- [Ollama API 문서](https://github.com/ollama/ollama/blob/main/docs/api.md)

### 관련 프로젝트
- `project_gradio_ocr_design.md`: 전체 프로젝트 설계서

---

## ✅ 문서 승인

- **작성자**: AI Assistant (Claude)
- **검토자**: -
- **승인일**: 2025-01-30
- **다음 리뷰**: 개발 완료 시

---

**END OF DOCUMENT**
